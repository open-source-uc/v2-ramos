---
import type { Blogs, Organization } from "@/types";
import { Pill } from "../ui/pill";

interface Props {
  blogContent: Blogs;
  organizationData: Organization;
  contentType: "resource" | "blog";
  primaryPillIcon?: any;
  secondaryPillIcon?: any;
  navigationSection?: {
    title: string;
    description: string;
    buttonText: string;
    buttonHref: string;
  };
}

const {
  blogContent,
  organizationData,
  contentType,
  primaryPillIcon,
  secondaryPillIcon,
  navigationSection,
} = Astro.props;

// Default labels based on content type
const contentTypeLabel = contentType === "resource" ? "Recurso" : "Artículo";
const tags = blogContent.tags
  ? blogContent.tags.split(",").map((tag) => tag.trim())
  : [];
// Default navigation section
const defaultNavigationSection =
  contentType === "resource"
    ? {
        title: "¿Te resultó útil este recurso?",
        description:
          "Explora más recursos y guías en nuestra sección de ayuda.",
        buttonText: "Ver Todos los Recursos",
        buttonHref: "/resources",
      }
    : {
        title: "¿Te gustó este artículo?",
        description: "Descubre más artículos y contenido en nuestro blog.",
        buttonText: "Ver Todos los Artículos",
        buttonHref: "/blog",
      };

const finalNavigationSection = navigationSection || defaultNavigationSection;
---

<div class="flex flex-col gap-4 max-w-4xl mx-auto px-4 sm:px-6 py-8 w-full">
  <!-- Header Section -->
  <a
    class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 hover:underline transition-colors"
    href={`/${contentType}s`}
  >
    ← Ver más {contentTypeLabel}s
  </a>
  <section class="border border-border rounded-md px-4 sm:px-6 py-6 sm:py-8">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold pb-4 break-words">
        {blogContent.title}
      </h1>
      <div class="flex items-center gap-3 mt-4 overflow-hidden">
        <div class="flex items-center gap-3 min-w-0 flex-1">
          <a
            href={organizationData.page_link || "#"}
            target="_blank"
            rel="noopener noreferrer"
            class="block"
          >
            <img
              src={organizationData.logo_url}
              alt={`Logo de ${organizationData.organization_name}`}
              class="w-10 h-10 rounded-full object-cover border-2 border-border hover:border-blue transition-colors"
            />
          </a>
          <div class="flex flex-col min-w-0">
            <div class="text-sm text-muted-foreground truncate">
              Por
              <a
                href={organizationData.page_link}
                target="_blank"
                rel="noopener noreferrer"
                class="font-medium text-foreground hover:text-blue transition-colors"
              >
                {organizationData.organization_name}
              </a>
            </div>
            <div class="text-xs text-muted-foreground truncate">
              Cargo: <span class="text-foreground">{blogContent.user_role}</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="flex items-center flex-wrap gap-2 mt-6 sm:mt-8">
      <Pill variant="blue" size="sm" icon={primaryPillIcon} className="">
        {contentTypeLabel}
      </Pill>
      <Pill variant="green" size="sm" icon={secondaryPillIcon} className="">
        {blogContent.readtime} Minutos de lectura
      </Pill>
      {
        tags.map((tag) => (
          <Pill variant="ghost_red" size="sm" className="">
            {tag}
          </Pill>
        ))
      }
    </div>
  </section>
  <!-- Content Section -->
  <article class="border border-border rounded-md overflow-hidden min-w-0">
    <div class="px-4 sm:px-6 py-6 sm:py-8">
      <div
        class="max-w-none text-foreground leading-relaxed content-markdown overflow-hidden break-words"
      >
        <slot />
      </div>
    </div>
  </article>
  <!-- Navigation Section -->
  <section class="mt-6">
    <div class="border border-border rounded-md p-4 sm:p-6">
      <div
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
      >
        <div class="min-w-0 flex-1">
          <h3 class="text-lg font-semibold text-foreground mb-2 break-words">
            {finalNavigationSection.title}
          </h3>
          <p class="text-sm text-muted-foreground break-words">
            {finalNavigationSection.description}
          </p>
        </div>
        <div class="flex gap-3 flex-shrink-0">
          <a
            href={finalNavigationSection.buttonHref}
            class="inline-flex items-center px-4 py-2 border border-border bg-background hover:bg-muted transition-colors rounded-md text-sm font-medium text-foreground whitespace-nowrap"
          >
            {finalNavigationSection.buttonText}
          </a>
        </div>
      </div>
    </div>
  </section>
</div>
