---
import type { ParsedPrerequisites } from "../../types";
import { ChevronDownIcon, ChevronUpIcon, BookOpenIcon } from "../icons/icons";
import PrerequisitesDisplay from "./PrerequisitesDisplay.astro";

interface Props {
    prerequisites: ParsedPrerequisites;
    className?: string;
}

const { prerequisites, className = "" } = Astro.props;
---

{prerequisites.hasPrerequisites && prerequisites.structure ? (
    <section class={`prerequisites-section ${className}`}>
        <div class="border border-border rounded-md overflow-hidden">
            <button 
                class="w-full px-6 py-4 text-left bg-background hover:bg-muted/50 transition-colors duration-200 flex items-center justify-between group"
                data-toggle="prerequisites"
                aria-expanded="false"
                aria-controls="prerequisites-content"
            >
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-purple-light text-purple border border-purple/20 rounded-lg">
                        <BookOpenIcon className="h-5 w-5 fill-current" />
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold text-foreground">
                            Prerrequisitos
                        </h2>
                        <p class="text-sm text-muted-foreground">
                            Conoce los cursos que necesitas para tomar este ramo
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm text-muted-foreground hidden sm:inline">
                        Click para expandir
                    </span>
                    <ChevronDownIcon className="h-5 w-5 text-muted-foreground transition-transform duration-200 group-hover:text-foreground" data-icon="chevron-down" />
                    <ChevronUpIcon className="h-5 w-5 text-muted-foreground transition-transform duration-200 group-hover:text-foreground hidden" data-icon="chevron-up" />
                </div>
            </button>
            
            <div 
                id="prerequisites-content"
                class="hidden border-t border-border px-6 py-4 bg-muted/20"
                data-content="prerequisites"
            >
                <PrerequisitesDisplay prerequisites={prerequisites.structure} />
                
                <div class="mt-4 pt-4 border-t border-border">
                    <div class="flex flex-wrap gap-4 text-xs text-muted-foreground">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-blue-50 border border-blue-200 rounded"></div>
                            <span>Prerrequisito regular</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-orange-50 border border-orange-200 rounded"></div>
                            <span>Prerrequisito corricular (c)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-semibold text-blue-600">y</span>
                            <span>Todos los cursos/grupos son requeridos</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-semibold text-green-600">o</span>
                            <span>Solo uno de los cursos/grupos es requerido</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
) : (
    <section class={`prerequisites-section ${className}`}>
        <div class="border border-border rounded-md p-6">
            <div class="flex items-center gap-3 text-muted-foreground">
                <div class="p-2 bg-muted text-muted-foreground border border-border rounded-lg">
                    <BookOpenIcon className="h-5 w-5 fill-current" />
                </div>
                <div>
                    <h2 class="text-lg font-semibold">
                        Prerrequisitos
                    </h2>
                    <p class="text-sm">
                        Este curso no tiene prerrequisitos
                    </p>
                </div>
            </div>
        </div>
    </section>
)}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleButton = document.querySelector('[data-toggle="prerequisites"]');
    const content = document.querySelector('[data-content="prerequisites"]');
    const chevronDown = document.querySelector('[data-icon="chevron-down"]');
    const chevronUp = document.querySelector('[data-icon="chevron-up"]');
    
    if (toggleButton && content && chevronDown && chevronUp) {
        toggleButton.addEventListener('click', function() {
            const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true';
            
            if (isExpanded) {
                // Collapse
                content.classList.add('hidden');
                toggleButton.setAttribute('aria-expanded', 'false');
                chevronDown.classList.remove('hidden');
                chevronUp.classList.add('hidden');
            } else {
                // Expand
                content.classList.remove('hidden');
                toggleButton.setAttribute('aria-expanded', 'true');
                chevronDown.classList.add('hidden');
                chevronUp.classList.remove('hidden');
            }
        });
    }
});
</script>

<style>
.prerequisites-section [data-toggle="prerequisites"]:focus {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
}

.prerequisites-section [data-toggle="prerequisites"]:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
}
</style>
