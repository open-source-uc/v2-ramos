---
import ContentPage from '@/components/common/ContentPage.astro'
import { EditIcon, ClockIcon } from '@/components/icons/icons'
import Layout from '@/layouts/Layout.astro'
import { createSlug } from '@/lib/utils'
import type { Blogs, Organization } from '@/types'
import { MarkdownReviewView } from '@/components'
import ConditionalEdit from '@/components/features/article/ConditionalEdit.tsx'
import config from '@/lib/const'

export const prerender = true

export async function getStaticPaths() {
	const response = await fetch(new URL('/api/blogs', config.BASEURL))
	const blogs: Blogs[] = await response.json()
	return blogs.map((blog) => ({
		params: {
			author: createSlug(blog.organization_name),
			title: createSlug(blog.title),
		},
		props: { blog },
	}))
}

const { blog } = Astro.props
const organizationRes = await fetch(`${config.AUTHURL}/api/organization/${blog.organization_id}`)
const organizationData = (await organizationRes.json()) as Organization
---

<Layout>
	<ConditionalEdit blogTitle={blog.title} blogUserId={blog.user_id} client:only="react" />
	<ContentPage
		contentData={blog}
		organizationData={organizationData}
		contentType="blog"
		primaryPillIcon={EditIcon}
		secondaryPillIcon={ClockIcon}
		navigationSection={{
			title: '¿Te gustó este blog?',
			description: 'Descubre más contenido interesante en los blogs que tenemos para ofrecerte.',
			buttonText: 'Ver Más Blogs',
			buttonHref: '/blogs',
		}}
	>
		<MarkdownReviewView path={blog.content_path} client:load />
	</ContentPage>
</Layout>
