---
import { getCollection, render } from "astro:content";
import ContentPage from "@/components/common/ContentPage.astro";
import { EditIcon, ClockIcon } from "../../../components/icons/icons";
import Layout from "@/layouts/Layout.astro";
import { createSlug } from "@/lib/utils";
import { Pill } from "@/components/ui/pill";
import type { Blogs, Organization } from "@/types";

export const prerender = true;

export async function getStaticPaths() {
  const response = await fetch("http://localhost:4321/api/blogs");
  const blogs: Blogs[] = await response.json();
  return blogs.map((blog) => ({
    params: {
      author: createSlug(blog.organization_name),
      title: createSlug(blog.title),
    },
    props: { blog },
  }));
}

const { blog } = Astro.props;
const userOrgRes = await fetch(
  `http://localhost:4322/api/user/${blog.user_id}`
);

const organizationRes = await fetch(
  `http://localhost:4322/api/organization/${blog.organization_id}`
);
const organizationData = (await organizationRes.json()) as Organization;
---

<Layout>
  <ContentPage
    blogContent={blog}
    organizationData={organizationData}
    contentType="blog"
    primaryPillIcon={EditIcon}
    secondaryPillIcon={ClockIcon}
    navigationSection={{
      title: "¿Te gustó este blog?",
      description:
        "Descubre más contenido interesante en los blogs que tenemos para ofrecerte.",
      buttonText: "Ver Más Artículos",
      buttonHref: "/blogs",
    }}
  />
</Layout>
